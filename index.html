<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Laporan Kondisi Barang Isu</title>

<!-- Link ke Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

<style>
:root{
  --primary:#2ecc71;
  --bg:#0f0c0c;
  --card:#1a1a1a;
  --text:#ffffff;
  --border:#333333;
  --input-bg:#2d2d2d;
  --shadow:rgba(0,0,0,0.5);
}

body{
  font-family:'Poppins', Segoe UI, Arial, sans-serif; /* Gunakan Poppins */
  background:var(--bg);
  padding:20px;
  margin:0;
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  background: linear-gradient(135deg, #0f0c0c 0%, #1a1a1a 50%, #0f0c0c 100%);
}

.container{
  max-width:480px;
  width:100%;
  background:var(--card);
  padding:32px;
  border-radius:16px;
  box-shadow:0 10px 30px var(--shadow);
  color:var(--text);
}

h1{
  text-align:center;
  color:var(--primary);
  margin-bottom:24px;
  font-size:1.8rem;
  font-weight: 600;
}

.form-group{
  margin-bottom:20px;
}

label{
  font-weight:500;
  display:block;
  margin-bottom:8px;
  color:var(--text);
}

input,select,button{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:1px solid var(--border);
  background:var(--input-bg);
  color:var(--text);
  font-size:1rem;
  font-family:'Poppins', Segoe UI, Arial, sans-serif; /* Terapkan juga ke input */
  transition: all 0.2s ease;
}

input:focus, select:focus{
  outline:none;
  border-color:var(--primary);
  box-shadow:0 0 0 2px rgba(46, 204, 113, 0.2);
}

/* Hapus spinner default untuk input number - PERBAIKAN DIMASUKKAN */
input[type="number"] {
  -moz-appearance: textfield; /* Untuk Firefox */
  appearance: textfield; /* Versi standar untuk masa depan */
}

input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button {
  -webkit-appearance: none; /* Untuk Chrome, Safari, Edge */
  appearance: none; /* Versi standar untuk masa depan */
  margin: 0;
}


.photo-preview{
  width:100%;
  height:200px;
  object-fit:cover;
  border-radius:12px;
  border:1px solid var(--border);
  display: block;
  margin-top: 10px;
  background:var(--input-bg);
  display:none;
}

.actions{
  display:flex;
  gap:12px;
  margin-top:20px;
  flex-direction: column;
}

button{
  background:var(--primary);
  color:#fff;
  border:none;
  cursor:pointer;
  padding:14px;
  border-radius:12px;
  font-weight:500;
  font-size:1rem;
  font-family:'Poppins', Segoe UI, Arial, sans-serif;
  transition: all 0.2s ease;
}

button:hover{
  background: #27ae60;
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(46, 204, 113, 0.3);
}

#loading{
  text-align:center;
  margin-top:20px;
  font-weight:bold;
  display:none;
  color:var(--primary);
}

button[type="button"]{
  background:var(--input-bg);
  border:1px solid var(--border);
  color:var(--text);
}

button[type="button"]:hover{
  background:var(--border);
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

#video{
  background:#000;
}

#canvas{
  display:none;
}

#cameraModal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.9);
  z-index:999;
  align-items:center;
  justify-content:center;
  padding:20px;
}

#cameraModal > div{
  background:#1a1a1a;
  padding:20px;
  border-radius:16px;
  max-width:420px;
  width:100%;
  box-shadow:0 10px 30px rgba(0,0,0,0.5);
}

#cameraModal button{
  margin-top:10px;
  width:100%;
}

#cameraModal button.secondary{
  background:#333;
  color:#fff;
}

#cameraModal button.secondary:hover{
  background:#444;
}

@media (max-width: 480px) {
  .container{
    padding:24px;
    margin:10px;
  }
  h1{
    font-size:1.5rem;
  }
}
</style>
</head>

<body>
<div class="container">
  <h1> LAPORAN PM HOLD</h1>

  <div class="form-group">
    <label>Nama</label>
    <input id="nama" required placeholder="Masukkan nama Anda">
  </div>

  <div class="form-group">
    <label>Tanggal</label>
    <input type="date" id="tanggal" required>
  </div>

  <div class="form-group">
    <label>Shift</label>
    <select id="shift" required>
      <option value="">Pilih Shift</option>
      <option>1</option>
      <option>2</option>
      <option>3</option>
    </select>
  </div>

  <div class="form-group">
    <label>Grup</label>
    <select id="grup" required>
      <option value="">Pilih Grup</option>
      <option>A</option>
      <option>B</option>
      <option>C</option>
    </select>
  </div>

  <div class="form-group">
    <label>Varian</label>
    <input id="varian" placeholder="Masukkan Varian" required>
  </div>

  <div class="form-group">
    <label>SPB</label>
    <input id="spb" placeholder="Masukkan Nomor SPB" required>
  </div>

  <div class="form-group">
    <label>QTY</label>
    <input type="number" id="qty" placeholder="Masukkan Jumlah" required min="0" step="1">
  </div>

  <div class="form-group">
    <label>Foto Barang Isu</label>
    <button onclick="openCamera('barangIsu')" type="button">üì∑ Ambil Foto</button>
    <img id="img_barangIsu" class="photo-preview" style="display:none;">
  </div>

  <div class="actions">
    <button onclick="submitData()">üì§ Kirim Laporan</button>
  </div>

  <div id="loading">‚è≥ Mengirim data...</div>
</div>

<!-- CAMERA MODAL -->
<div id="cameraModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.8);z-index:999;align-items:center;justify-content:center">
  <div style="background:#1a1a1a;padding:16px;border-radius:12px;max-width:420px;width:100%">
    <video id="video" autoplay playsinline style="width:100%;border-radius:10px"></video>
    <canvas id="canvas" style="display:none"></canvas>
    <div style="display:flex;gap:10px;margin-top:10px">
      <button onclick="takePhoto()">üì∏ Ambil Foto</button>
      <button onclick="closeCamera()" class="secondary">‚ùå Tutup</button>
    </div>
  </div>
</div>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzxpGPDOknP5UmaDB28jfD0KHhnA2IkKSdLTuAuc0SwyjrIVHhdRElm6sjB6RWQEbUBrw/exec";

let camStream=null;
let currentPhotoField = null;

function openCamera(fieldId){
  currentPhotoField = fieldId;
  cameraModal.style.display="flex";
  navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}})
    .then(stream => {
      camStream = stream;
      video.srcObject = camStream;
    })
    .catch(err => {
      console.error("Error accessing camera:", err);
      alert("Gagal mengakses kamera. Pastikan izin telah diberikan.");
    });
}

function takePhoto(){
  if (!camStream) return;
  const context = canvas.getContext("2d");
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  context.drawImage(video, 0, 0, canvas.width, canvas.height);

  const imageDataUrl = canvas.toDataURL("image/jpeg", 0.8);
  const targetImg = document.getElementById(`img_${currentPhotoField}`);
  if(targetImg) {
    targetImg.src = imageDataUrl;
    targetImg.style.display = "block";
  }

  closeCamera();
}

function closeCamera(){
  cameraModal.style.display="none";
  if(camStream){
    camStream.getTracks().forEach(track => track.stop());
    camStream = null;
  }
}

async function submitData(){
  const namaVal = nama.value;
  const tanggalVal = tanggal.value;
  const shiftVal = shift.value;
  const grupVal = grup.value;
  const varianVal = varian.value;
  const spbVal = spb.value;
  const qtyVal = qty.value;

  if (!namaVal || !tanggalVal || !shiftVal || !grupVal || !varianVal || !spbVal || !qtyVal) {
    alert("Harap isi semua field wajib.");
    return;
  }

  loading.style.display = "block";

  const formData = new FormData();
  formData.append("nama", namaVal);
  formData.append("tanggal", tanggalVal);
  formData.append("shift", shiftVal);
  formData.append("grup", grupVal);
  formData.append("varian", varianVal);
  formData.append("spb", spbVal);
  formData.append("qty", qtyVal);
  formData.append(
    "foto_barang_isu",
    document.getElementById("img_barangIsu").src || ""
  );

  try {
    const response = await fetch(WEB_APP_URL, {
      method: "POST",
      body: formData
    });

    const result = await response.text();
    console.log("Server response:", result);

    if (response.ok && result.includes("SUCCESS")) {
      alert("‚úÖ Laporan berhasil dikirim");
      location.reload();
    } else {
      throw new Error(result);
    }

  } catch (err) {
    console.error(err);
    alert("‚ùå Gagal mengirim laporan.\nPeriksa koneksi atau server.");
  } finally {
    loading.style.display = "none";
  }
}
</script>
</body>

</html>

